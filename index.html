<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Rescisão - Dr. Marcílio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --cor-primaria: #a27b4f; /* Dourado da logo */
            --cor-secundaria: #c9a77c; /* Dourado mais claro */
            --cor-fundo: #1c1c1c; /* Preto da logo */
            --cor-card: #2c2c2c; /* Cinza escuro */
            --cor-texto: #f0f0f0; /* Branco para o texto */
            --cor-borda: #444444; /* Borda cinza */
            --cor-sucesso: #a27b4f;
            --cor-alerta: #ffeb3b;
            --cor-erro: #e8586c;
            --cor-sombra: rgba(255, 255, 255, 0.05);
            --cor-sombra-escura: rgba(255, 255, 255, 0.1);
            --transicao: all 0.3s ease;
        }

        /* Tema Padrão (Agora escuro) */
        body {
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            margin: 0;
            padding: 20px 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transicao);
            font-family: 'Inter', sans-serif;
        }

        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header {
            background: var(--cor-primaria);
            color: black;
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            box-shadow: 0 4px 8px var(--cor-sombra-escura);
        }

        .header h1 {
            margin: 0 0 5px;
            font-size: 1.8em;
            font-weight: 700;
        }

        .header p {
            margin: 0;
            font-size: 0.9em;
            font-weight: 400;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background-color: var(--cor-card);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 8px var(--cor-sombra);
            transition: var(--transicao);
        }

        .card h2 {
            margin-top: 0;
            color: var(--cor-primaria);
            border-bottom: 2px solid var(--cor-borda);
            padding-bottom: 10px;
        }

        .form-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--cor-secundaria);
            box-shadow: 0 0 0 2px rgba(201, 167, 124, 0.2);
        }

        .form-group.horizontal {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }
        
        .form-group.horizontal label {
            margin-bottom: 0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Ajuste específico para a grid de 3 colunas */
        .form-grid.grid-3-col {
            grid-template-columns: repeat(3, 1fr); /* Força 3 colunas de largura igual */
        }

        /* Adicionado para alinhar os inputs na aba "Avançado" */
        @media (min-width: 769px) {
            .form-grid.grid-3-col .form-group label {
                min-height: 55px;
            }
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--cor-borda);
        }

        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--cor-texto);
            font-weight: 600;
            transition: var(--transicao);
        }

        .tab-button.active {
            border-bottom: 3px solid var(--cor-primaria);
            color: var(--cor-primaria);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transicao);
        }

        .btn-primary {
            background-color: var(--cor-primaria);
            color: black;
            box-shadow: 0 4px 6px var(--cor-sombra);
        }

        .btn-primary:hover {
            background-color: #7a5f44;
            box-shadow: 0 6px 10px var(--cor-sombra-escura);
        }

        .btn-secondary {
            background-color: var(--cor-card);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-primaria);
        }

        .btn-secondary:hover {
            background-color: var(--cor-fundo);
        }
        
        .btn-export {
            background-color: var(--cor-sucesso);
            color: black;
        }

        .btn-export:hover {
            background-color: #7a5f44;
        }

        #result-section {
            display: none;
        }

        .summary-card {
            background-color: var(--cor-primaria);
            color: black;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px var(--cor-sombra-escura);
        }

        .summary-card p {
            margin: 0;
            font-size: 1.2em;
            opacity: 0.8;
        }

        .summary-card h3 {
            margin: 5px 0 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .summary-card.negative {
            background-color: var(--cor-erro);
        }
        
        .result-details {
            margin-top: 20px;
        }
        
        .result-details table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            display: block; /* Para permitir o scroll horizontal */
            overflow-x: auto;
        }

        .result-details table th, .result-details table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--cor-borda);
        }

        .result-details table th {
            background-color: var(--cor-fundo);
            font-weight: 600;
        }
        
        .valor-devido { color: var(--cor-sucesso); font-weight: 600; }
        .valor-desconto { color: var(--cor-erro); font-weight: 600; }

        .legal-notes {
            margin-top: 20px;
            padding-left: 20px;
            list-style: disc;
        }
        
        .legal-notes li {
            margin-bottom: 8px;
        }

        .disclaimer-rodape {
            text-align: center;
            font-size: 0.8em;
            color: #888;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid var(--cor-borda);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--cor-card);
            color: var(--cor-texto);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--cor-borda);
            box-shadow: 0 2px 5px var(--cor-sombra);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--cor-borda) transparent transparent transparent;
        }
        
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--cor-card);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px var(--cor-sombra-escura);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 350px;
        }
        
        .message-box h3 {
            margin-top: 0;
            color: var(--cor-primaria);
        }
        
        .message-box p {
            margin: 15px 0;
        }
        
        .message-box button {
            background-color: var(--cor-primaria);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Estilos para impressão */
        @media print {
            body {
                background: none;
                padding: 0;
                color: #000;
            }
            .container {
                max-width: none;
                width: 100%;
            }
            .header, .form-section, .btn-group, .disclaimer-rodape, #scenario-comparison, .btn-toggle {
                display: none;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                padding: 15px;
                margin-bottom: 20px;
            }
            #result-section {
                display: block !important;
                margin-top: 0;
            }
            .report-logo {
                display: block !important;
                margin: 0 auto 20px;
                text-align: center;
            }
            .report-logo h1 {
                margin: 0;
                color: var(--cor-primaria);
            }
            .summary-card {
                background-color: var(--cor-fundo);
                color: var(--cor-texto);
                border: 1px solid var(--cor-borda);
            }
            .valor-devido, .valor-desconto {
                color: inherit;
            }
        }
        
        .report-logo {
            display: none;
        }
        
        /* Tema Escuro para o logo no relatório */
        body.dark-theme .report-logo h1 {
            color: var(--cor-primaria);
        }

        /* Cenários comparativos */
        #scenario-comparison {
            display: none;
            margin-top: 20px;
        }

        #scenario-comparison table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            display: block; /* Para permitir o scroll horizontal */
            overflow-x: auto;
            white-space: nowrap; /* Impede a quebra de linha nas células */
        }

        #scenario-comparison table th, #scenario-comparison table td {
            padding: 12px;
            border: 1px solid var(--cor-borda);
            text-align: center;
        }
        
        #scenario-comparison table th {
            background-color: var(--cor-primaria);
            color: white;
        }
        
        #scenario-comparison table tr:nth-child(even) {
            background-color: var(--cor-fundo);
        }
        
        #scenario-comparison table td:first-child {
            text-align: left;
            font-weight: 600;
            white-space: normal;
        }
        
        /* Otimizações para telas pequenas */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .card {
                padding: 15px;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .form-group.horizontal {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .btn {
                width: 100%;
            }
        }

        /* Tooltip para o FGTS */
        #fgts-estimation-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #fgts-estimation-group label {
            white-space: nowrap;
        }

        .horizontal-spaced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        /* Novo estilo para o alinhamento da pergunta */
        .form-group.spaced-row {
            display: flex;
            justify-content: flex-start; /* Alinhado à esquerda */
            align-items: center;
            flex-direction: row;
        }
        
        .form-group.spaced-row .label-and-tooltip {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-group.spaced-row input[type="checkbox"] {
            margin-left: 10px; /* Adiciona espaço entre o texto e o checkbox */
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
            border: 3px solid var(--cor-primaria);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Largura fixa para campos de data */
        #salarioBase, #faltasDescontos, #fgtsSaldo {
            max-width: 300px;
            box-sizing: border-box;
        }
        #dataAdmissao, #dataDesligamento {
            max-width: 250px; 
            box-sizing: border-box; 
        }
        #observacoes {
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Calculadora de Rescisão — Dr. Marcílio</h1>
            <p>Estimativa de verbas rescisórias conforme a CLT</p>
        </div>

        <div class="main-content">
            <div class="card">
                <div class="tabs">
                    <button class="tab-button active" data-tab="tab-basico">Básico</button>
                    <button class="tab-button" data-tab="tab-avancado">Avançado</button>
                </div>

                <form id="rescisao-form">
                    <div id="tab-basico" class="tab-content active">
                        <h2>Dados Essenciais</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tipoDesligamento">Tipo de Desligamento</label>
                                <select id="tipoDesligamento" required>
                                    <option value="">Selecione...</option>
                                    <option value="sem-justa-causa">Sem Justa Causa</option>
                                    <option value="pedido-demissao">Pedido de Demissão</option>
                                    <option value="justa-causa">Justa Causa</option>
                                    <option value="acordo">Acordo (Art. 484-A)</option>
                                    <option value="rescisao-indireta">Rescisão Indireta</option>
                                    <option value="termino-experiencia">Término Contrato Experiência</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="salarioBase">Salário Base Mensal (R$)</label>
                                <input type="text" id="salarioBase" class="currency" value="1518,00" required>
                            </div>
                            <div class="form-group">
                                <label for="dataAdmissao">Data de Admissão</label>
                                <input type="date" id="dataAdmissao" value="2024-01-15" required>
                            </div>
                            <div class="form-group">
                                <label for="dataDesligamento">Data de Desligamento</label>
                                <input type="date" id="dataDesligamento" value="2024-08-28" required>
                            </div>
                            <div class="form-group">
                                <label for="avisoModelo">Aviso Prévio</label>
                                <select id="avisoModelo" required>
                                    <option value="trabalhado">Trabalhado</option>
                                    <option value="indenizado">Indenizado</option>
                                    <option value="nao-cumprido">Não Cumprido (Descontar)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="faltasDescontos">Faltas/Descontos no Mês (R$)</label>
                                <input type="text" id="faltasDescontos" class="currency" value="0,00">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="fgtsOption">Saldo do FGTS</label>
                            <select id="fgtsOption" required>
                                <option value="informar">Informar Saldo Total</option>
                                <option value="estimar">Estimar Saldo</option>
                            </select>
                        </div>
                        <div class="form-group" id="fgts-informado-group">
                            <label for="fgtsSaldo">Saldo Total de FGTS (R$)</label>
                            <input type="text" id="fgtsSaldo" class="currency" value="5000,00" required>
                        </div>
                        <div class="form-group" id="fgts-estimar-group" style="display: none;">
                            <label for="fgtsMeses">Meses de Contribuição</label>
                            <input type="number" id="fgtsMeses" value="12" min="1" required>
                        </div>

                        <div class="form-group spaced-row">
                            <div class="label-and-tooltip">
                                <label for="feriasVencidas">Possui Férias vencidas?</label>
                                <div class="tooltip">
                                    <span class="tooltip-icon">ⓘ</span>
                                    <span class="tooltiptext">Marque esta opção se o trabalhador possui um período aquisitivo de férias de 12 meses completo, mas ainda não gozou do descanso.</span>
                                </div>
                            </div>
                            <input type="checkbox" id="feriasVencidas">
                        </div>

                        <div class="form-group">
                            <label for="observacoes">Observacoes</label>
                            <textarea id="observacoes" rows="3" placeholder="Insira aqui informações adicionais para o relatório..."></textarea>
                        </div>
                    </div>

                    <div id="tab-avancado" class="tab-content">
                        <h2>Opções Avançadas</h2>
                        <h3>Médias e Adicionais</h3>
                        <div class="form-grid grid-3-col">
                            <div class="form-group">
                                <label for="mediaHorasExtras">Média de Horas Extras mensais (R$)</label>
                                <input type="text" id="mediaHorasExtras" class="currency" value="0,00">
                            </div>
                            <div class="form-group">
                                <label for="mediaAdicionais">Média de Adicionais (R$) <small>(Periculosidade, Insalubridade)</small></label>
                                <input type="text" id="mediaAdicionais" class="currency" value="0,00">
                            </div>
                            <div class="form-group">
                                <label for="mediaComissoes">Média de Comissões mensais (R$)</label>
                                <input type="text" id="mediaComissoes" class="currency" value="0,00">
                            </div>
                        </div>

                        <h3>Descontos</h3>
                        <div class="form-group horizontal-spaced">
                            <label for="pensaoAbre">Pensão Alimentícia?</label>
                            <input type="checkbox" id="pensaoAbre">
                        </div>
                        <div class="form-group" id="pensao-group" style="display: none;">
                            <label for="pensaoValor">Valor da Pensão</label>
                            <input type="text" id="pensaoValor" class="currency" value="200,00" placeholder="R$">
                        </div>

                        <h3>Tabelas INSS/IRRF</h3>
                        <p><small>Valores baseados na tabela de 2024, editáveis para atualização.</small></p>
                        <div class="tabelas-container">
                            <h4>Tabela INSS (Alíquota x Parcela a deduzir)</h4>
                            <div id="inss-table-editor"></div>
                            <h4>Tabela IRRF (Alíquota x Parcela a deduzir)</h4>
                            <div id="irrf-table-editor"></div>
                        </div>
                        
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Calcular</button>
                        <button type="button" id="compare-btn" class="btn btn-secondary">Comparar Cenários</button>
                        <button type="button" id="limpar-btn" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>

            <div id="scenario-comparison" class="card">
                <h2>Comparador de Cenários</h2>
                <table id="comparison-table">
                    <thead>
                        <tr>
                            <th>Verba</th>
                            <th>Sem Justa Causa</th>
                            <th>Pedido de Demissão</th>
                            <th>Justa Causa</th>
                            <th>Acordo (484-A)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="result-section" class="card">
                <div class="report-logo">
                    <h1>Dr. Marcílio</h1>
                    <p>Advocacia Trabalhista</p>
                    <p>Relatório de Estimativa de Rescisão - <span id="report-date"></span></p>
                </div>
                <h2>Resultado da Simulação</h2>
                <div class="summary-card">
                    <p>Líquido a Receber</p>
                    <h3 id="valor-liquido">R$ 0,00</h3>
                </div>
                <div class="result-details">
                    <p>Total Bruto: <strong id="valor-bruto">R$ 0,00</strong></p>
                    <p>Total de Descontos: <strong id="valor-descontos">R$ 0,00</strong></p>

                    <h3>Memória de Cálculo</h3>
                    <table id="calculation-table">
                        <thead>
                            <tr>
                                <th>Verba</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <div id="legal-warnings">
                        <h3>Avisos Legais</h3>
                        <ul class="legal-notes"></ul>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" id="print-btn" class="btn btn-secondary">Imprimir</button>
                    <button type="button" id="pdf-btn" class="btn btn-secondary btn-export">Exportar PDF</button>
                    <button type="button" id="share-btn" class="btn btn-secondary">Compartilhar Link</button>
                    <button type="button" id="whatsapp-btn" class="btn btn-secondary">Enviar via WhatsApp</button>
                </div>
            </div>
            
            <div class="card about-section">
                <h2>Sobre o Dr. Marcílio</h2>
                <img src="imagens/10.jpg" class="profile-photo" alt="Foto de perfil do Dr. Marcílio">
                <p>O Dr. Marcílio Pardinho das Chagas é advogado trabalhista com atuação firme e estratégica na defesa dos direitos de trabalhadores e trabalhadoras em todo o Brasil. Reconhecido por sua postura combativa e técnica, coloca à disposição esta ferramenta com o objetivo de oferecer a você, trabalhador, uma estimativa educativa e simplificada dos seus cálculos rescisórios, com base na legislação da Consolidação das Leis do Trabalho (CLT).</p>
                <p>Este cálculo é uma simulação preliminar, que serve como ponto de partida para compreender os valores que podem ser devidos em uma rescisão contratual. No entanto, cada caso possui particularidades jurídicas que exigem análise profissional e personalizada.</p>
                <p>Se você acredita que seus direitos foram violados ou deseja uma orientação jurídica completa, com respaldo técnico e estratégico, não hesite:
                    <br>Entre em contato com o Dr. Marcílio e lute pelos seus direitos com quem entende do assunto.
                    <br>
                    <br>Seus direitos não podem esperar. Agende sua consulta agora.</p>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <a href="https://api.whatsapp.com/send?phone=5538992317937" target="_blank" style="padding: 10px 15px; background-color: #25D366; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">
                        Fale no WhatsApp
                    </a>
                    <a href="mailto:marciliiochagas@outlook.com" style="padding: 10px 15px; background-color: var(--cor-secundaria); color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">
                        Envie um Email
                    </a>
                </div>
            </div>
        </div>

        <div class="disclaimer-rodape">
            <p>Ferramenta de estimativa. Regras podem variar por convenção coletiva, adicionais, decisões judiciais e atualizações legais. Consulte o Advogado Marcílio para cálculo oficial e orientação.</p>
        </div>
    </div>
    
    <div id="message-box" class="message-box">
        <h3 id="message-title"></h3>
        <p id="message-text"></p>
        <button id="message-ok-btn">OK</button>
    </div>

    <script>
        // Mapeamento de DOM e variáveis globais
        const $ = s => document.querySelector(s);
        const $$ = s => document.querySelectorAll(s);

        const form = $('#rescisao-form');
        const tipoDesligamentoSelect = $('#tipoDesligamento');
        const avisoGroup = $('#aviso-group');
        const fgtsOptionSelect = $('#fgtsOption');
        const fgtsInformadoGroup = $('#fgts-informado-group');
        const fgtsEstimarGroup = $('#fgts-estimar-group');
        const pensaoAbreCheckbox = $('#pensaoAbre');
        const pensaoGroup = $('#pensao-group');
        const resultSection = $('#result-section');
        const valorLiquido = $('#valor-liquido');
        const valorBruto = $('#valor-bruto');
        const valorDescontos = $('#valor-descontos');
        const calculationTableBody = $('#calculation-table tbody');
        const legalNotesList = $('.legal-notes');
        const compareBtn = $('#compare-btn');
        const limparBtn = $('#limpar-btn');
        const comparisonTableBody = $('#comparison-table tbody');
        const scenarioComparisonSection = $('#scenario-comparison');
        const printBtn = $('#print-btn');
        const pdfBtn = $('#pdf-btn');
        const shareBtn = $('#share-btn');
        const whatsappBtn = $('#whatsapp-btn');
        const reportDateSpan = $('#report-date');

        // Constantes e tabelas (base 2024, editáveis)
        let inssTabela = [
            { limite: 1412.00, aliquota: 0.075, deducao: 0.00 },
            { limite: 2666.68, aliquota: 0.09, deducao: 21.18 },
            { limite: 4000.03, aliquota: 0.12, deducao: 101.18 },
            { limite: 7786.02, aliquota: 0.14, deducao: 181.18 }
        ];

        let irrfTabela = [
            { limite: 2259.20, aliquota: 0.0, deducao: 0.00 },
            { limite: 2826.65, aliquota: 0.075, deducao: 169.44 },
            { limite: 3751.05, aliquota: 0.15, deducao: 381.44 },
            { limite: 4664.68, aliquota: 0.225, deducao: 662.77 },
            { limite: Infinity, aliquota: 0.275, deducao: 896.00 }
        ];

        const inssTeto = 7786.02;

        const seguroDesempregoTabela = [
            { limite: 2041.39, aliquota: 0.8, parcelaFixa: 0.0 },
            { limite: 3409.52, aliquota: 0.5, parcelaFixa: 816.55 },
            { limite: Infinity, aliquota: 0.0, parcelaFixa: 2313.74 }
        ];

        // Mapeamento de tipos de rescisão para regras
        const regrasRescisao = {
            'sem-justa-causa': {
                multaFgts: 0.40,
                avisoPrevio: true,
                fgtsSaque: true,
                seguroDesemprego: true,
                avisoDesconta: false,
                decimoTerceiro: true,
                feriasProporcionais: true,
                verbas: ['Saldo de Salário', 'Aviso Prévio', '13º Salário', 'Férias Vencidas', 'Férias Proporcionais', 'Multa FGTS']
            },
            'pedido-demissao': {
                multaFgts: 0.0,
                avisoPrevio: true,
                fgtsSaque: false,
                seguroDesemprego: false,
                avisoDesconta: true,
                decimoTerceiro: true,
                feriasProporcionais: true,
                verbas: ['Saldo de Salário', '13º Salário', 'Férias Vencidas', 'Férias Proporcionais']
            },
            'justa-causa': {
                multaFgts: 0.0,
                avisoPrevio: false,
                fgtsSaque: false,
                seguroDesemprego: false,
                avisoDesconta: false,
                decimoTerceiro: false,
                feriasProporcionais: false,
                verbas: ['Saldo de Salário', 'Férias Vencidas']
            },
            'acordo': {
                multaFgts: 0.20,
                avisoPrevio: true,
                aviso50p: true,
                fgtsSaque: true,
                seguroDesemprego: false,
                avisoDesconta: false,
                decimoTerceiro: true,
                feriasProporcionais: true,
                verbas: ['Saldo de Salário', 'Aviso Prévio (50%)', '13º Salário', 'Férias Vencidas', 'Férias Proporcionais', 'Multa FGTS (20%)']
            },
            'rescisao-indireta': {
                multaFgts: 0.40,
                avisoPrevio: true,
                fgtsSaque: true,
                seguroDesemprego: true,
                avisoDesconta: false,
                decimoTerceiro: true,
                feriasProporcionais: true,
                verbas: ['Saldo de Salário', 'Aviso Prévio', '13º Salário', 'Férias Vencidas', 'Férias Proporcionais', 'Multa FGTS']
            },
            'termino-experiencia': {
                multaFgts: 0.0,
                avisoPrevio: false,
                fgtsSaque: true,
                seguroDesemprego: false,
                avisoDesconta: false,
                decimoTerceiro: true,
                feriasProporcionais: true,
                verbas: ['Saldo de Salário', '13º Salário', 'Férias Vencidas', 'Férias Proporcionais', 'Saque FGTS (sim)']
            }
        };

        // Funções de formatação e utilitários
        function parseCurrency(value) {
            if (!value) return 0;
            return parseFloat(value.replace(/\./g, '').replace(',', '.'));
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function formatDate(date) {
            return date.toLocaleDateString('pt-BR');
        }

        function showMessage(title, message, isError = false) {
            const msgBox = $('#message-box');
            const msgTitle = $('#message-title');
            const msgText = $('#message-text');
            const msgBtn = $('#message-ok-btn');
            
            msgTitle.textContent = title;
            msgText.textContent = message;
            msgBox.style.display = 'block';
            msgBtn.onclick = () => msgBox.style.display = 'none';
        }

        // Funções de cálculo
        function getMonthsWorked(admissao, desligamento, consideraDiaUtil) {
            const dataAdmissao = new Date(admissao);
            const dataDesligamento = new Date(desligamento);
            const diaDesligamento = dataDesligamento.getDate();

            let mesesTrabalhados = 0;
            let anoAtual = dataAdmissao.getFullYear();
            let mesAtual = dataAdmissao.getMonth();

            while (new Date(anoAtual, mesAtual, 1) < dataDesligamento) {
                mesesTrabalhados++;
                mesAtual++;
                if (mesAtual > 11) {
                    mesAtual = 0;
                    anoAtual++;
                }
            }

            // Mês do desligamento
            if (consideraDiaUtil && diaDesligamento >= 15) {
                return mesesTrabalhados + 1;
            } else if (!consideraDiaUtil) {
                return mesesTrabalhados;
            }
            return mesesTrabalhados;
        }
        
        function getAnosCompletos(admissao, desligamento) {
            const start = new Date(admissao);
            const end = new Date(desligamento);
            let years = end.getFullYear() - start.getFullYear();
            
            // Ajusta se o aniversário de contrato ainda não chegou
            if (end.getMonth() < start.getMonth() || (end.getMonth() === start.getMonth() && end.getDate() < start.getDate())) {
                years--;
            }
            return years;
        }

        function calcSalarioSaldo(salario, dataDesligamento) {
            const diasNoMes = new Date(dataDesligamento.getFullYear(), dataDesligamento.getMonth() + 1, 0).getDate();
            const diasTrabalhados = dataDesligamento.getDate();
            return (salario / diasNoMes) * diasTrabalhados;
        }

        function calcAvisoPrevio(salarioBase, mediaVerbas, dataAdmissao, dataDesligamento) {
            const salarioComMedias = salarioBase + mediaVerbas;
            const anosCompletos = getAnosCompletos(dataAdmissao, dataDesligamento);
            const diasAviso = 30 + Math.min(60, anosCompletos * 3); // Limite de 90 dias
            
            return (salarioComMedias / 30) * diasAviso;
        }

        function calcDecimoTerceiro(salarioBase, mediaVerbas, dataAdmissao, dataDesligamento) {
            const salarioComMedias = salarioBase + mediaVerbas;
            const dataAdmissaoObj = new Date(dataAdmissao);
            const dataDesligamentoObj = new Date(dataDesligamento);
            
            let mesesProporcionais = dataDesligamentoObj.getMonth() + 1;
            if (dataDesligamentoObj.getDate() < 15) {
                mesesProporcionais--;
            }

            if (dataAdmissaoObj.getFullYear() === dataDesligamentoObj.getFullYear()) {
                mesesProporcionais = (dataDesligamentoObj.getMonth() - dataAdmissaoObj.getMonth()) + 1;
                if (dataDesligamentoObj.getDate() < 15 && dataAdmissaoObj.getMonth() === dataDesligamentoObj.getMonth()) {
                     mesesProporcionais = 0;
                } else if(dataDesligamentoObj.getDate() < 15){
                     mesesProporcionais--;
                }
            }

            return (salarioComMedias / 12) * mesesProporcionais;
        }

        function calcFeriasProporcionais(salarioBase, mediaVerbas, dataAdmissao, dataDesligamento) {
            const salarioComMedias = salarioBase + mediaVerbas;
            const mesesTrabalhados = getMonthsWorked(dataAdmissao, dataDesligamento, true);
            const mesesAquisitivosIncompletos = mesesTrabalhados % 12;
            
            // Cálculo das férias proporcionais + 1/3
            return (salarioComMedias / 12) * mesesAquisitivosIncompletos * (4/3);
        }

        function calcFeriasVencidas(salarioBase, mediaVerbas) {
            const salarioComMedias = salarioBase + mediaVerbas;
            return salarioComMedias * (4/3);
        }
        
        function calcFgtsSaldo(fgtsOption, fgtsSaldo, fgtsMeses, salarioBase, mediaVerbas) {
            if (fgtsOption === 'informar') {
                return fgtsSaldo;
            } else {
                const salarioComMedias = salarioBase + mediaVerbas;
                return (salarioComMedias * 0.08) * fgtsMeses;
            }
        }
        
        function calcMultaFgts(fgtsSaldo, aliquota) {
            return fgtsSaldo * aliquota;
        }

        function calcINSS(baseCalculo) {
            let inssValor = 0;
            const base = Math.min(baseCalculo, inssTeto);

            for (const faixa of inssTabela) {
                if (base <= faixa.limite) {
                    inssValor = (base * faixa.aliquota) - faixa.deducao;
                    return Math.max(0, inssValor);
                }
            }
            // Para valores acima da última faixa (teto)
            const ultimaFaixa = inssTabela[inssTabela.length - 1];
            inssValor = (base * ultimaFaixa.aliquota) - ultimaFaixa.deducao;
            return Math.max(0, inssValor);
        }

        function calcIRRF(baseCalculo) {
            let irrfValor = 0;
            for (const faixa of irrfTabela) {
                if (baseCalculo <= faixa.limite) {
                    irrfValor = (baseCalculo * faixa.aliquota) - faixa.deducao;
                    return Math.max(0, irrfValor);
                }
            }
            // Para valores acima da última faixa
            const ultimaFaixa = irrfTabela[irrfTabela.length - 1];
            irrfValor = (baseCalculo * ultimaFaixa.aliquota) - ultimaFaixa.deducao;
            return Math.max(0, irrfValor);
        }
        
        // Função principal que agrega todos os cálculos
        function calcRescisao(data) {
            const {
                tipoDesligamento, salarioBase, dataAdmissao, dataDesligamento,
                avisoModelo, faltasDescontos, feriasVencidas,
                fgtsOption, fgtsSaldo, fgtsMeses,
                mediaHorasExtras, mediaAdicionais, mediaComissoes, pensaoAbre, pensaoValor
            } = data;
            
            const admissao = new Date(`${dataAdmissao}T00:00:00`);
            const desligamento = new Date(`${dataDesligamento}T00:00:00`);

            const regras = regrasRescisao[tipoDesligamento];
            const mediaVerbas = mediaHorasExtras + mediaAdicionais + mediaComissoes;
            
            let bruto = 0;
            let descontos = 0;
            const verbas = {};
            const elegibilidade = {
                fgtsSaque: regras.fgtsSaque,
                seguroDesemprego: regras.seguroDesemprego,
                avisoPrazo: 'Em até 10 dias corridos contados do término do contrato.'
            };
            
            // 1. Saldo de Salário
            const saldoSalario = calcSalarioSaldo(salarioBase + mediaVerbas, desligamento);
            verbas['Saldo de Salário'] = { valor: saldoSalario, formula: `(${formatCurrency(salarioBase + mediaVerbas)} ÷ ${new Date(desligamento.getFullYear(), desligamento.getMonth() + 1, 0).getDate()} dias) × ${desligamento.getDate()} dias` };
            bruto += saldoSalario;

            // 2. Aviso Prévio
            const avisoPrevioValor = calcAvisoPrevio(salarioBase, mediaVerbas, admissao, desligamento);
            if (regras.avisoPrevio) {
                if (avisoModelo === 'indenizado') {
                    const valorFinalAviso = regras.aviso50p ? avisoPrevioValor / 2 : avisoPrevioValor;
                    const nomeVerba = `Aviso Prévio ${regras.aviso50p ? '(50%)' : 'Indenizado'}`;
                    verbas[nomeVerba] = { valor: valorFinalAviso, formula: `Base de ${formatCurrency(salarioBase + mediaVerbas)}` };
                    bruto += valorFinalAviso;
                } else if (avisoModelo === 'nao-cumprido' && tipoDesligamento === 'pedido-demissao') {
                    verbas['Desconto Aviso Prévio'] = { valor: -avisoPrevioValor, formula: `Desconto por não cumprimento` };
                    descontos += avisoPrevioValor;
                }
            }

            // 3. 13º Salário
            let decimoTerceiro = 0;
            if (regras.decimoTerceiro) {
                decimoTerceiro = calcDecimoTerceiro(salarioBase, mediaVerbas, admissao, desligamento);
                verbas['13º Salário Proporcional'] = { valor: decimoTerceiro, formula: `Proporcional aos meses trabalhados no ano` };
                bruto += decimoTerceiro;
            }

            // 4. Férias
            if (feriasVencidas) {
                const feriasVencidasValor = calcFeriasVencidas(salarioBase, mediaVerbas);
                verbas['Férias Vencidas + 1/3'] = { valor: feriasVencidasValor, formula: 'Valor integral + 1/3 constitucional' };
                bruto += feriasVencidasValor;
            }

            if (regras.feriasProporcionais) {
                const feriasProporcionais = calcFeriasProporcionais(salarioBase, mediaVerbas, admissao, desligamento);
                verbas['Férias Proporcionais + 1/3'] = { valor: feriasProporcionais, formula: 'Proporcional aos meses do período aquisitivo' };
                bruto += feriasProporcionais;
            }

            // 5. FGTS e Multa
            const fgtsSaldoCalculado = calcFgtsSaldo(fgtsOption, fgtsSaldo, fgtsMeses, salarioBase, mediaVerbas);
            if (regras.multaFgts > 0) {
                const multaFgts = calcMultaFgts(fgtsSaldoCalculado, regras.multaFgts);
                const percentual = (regras.multaFgts * 100).toFixed(0);
                verbas[`Multa FGTS (${percentual}%)`] = { valor: multaFgts, formula: `${percentual}% sobre o saldo de ${formatCurrency(fgtsSaldoCalculado)}` };
                bruto += multaFgts;
            }

            // 6. Descontos
            const baseINSS = saldoSalario + decimoTerceiro;
            const inssValor = calcINSS(baseINSS);
            if (inssValor > 0) {
                verbas['INSS'] = { valor: -inssValor, formula: 'Desconto sobre saldo de salário e 13º' };
                descontos += inssValor;
            }
            
            const baseIRRF = bruto - inssValor; // Simplificado, o cálculo real é mais complexo
            const irrfValor = calcIRRF(baseIRRF);
            if (irrfValor > 0) {
                verbas['IRRF'] = { valor: -irrfValor, formula: 'Estimativa de desconto sobre o total bruto' };
                descontos += irrfValor;
            }

            if (faltasDescontos > 0) {
                verbas['Outros Descontos'] = { valor: -faltasDescontos, formula: 'Faltas e adiantamentos informados' };
                descontos += faltasDescontos;
            }

            if (pensaoAbre && pensaoValor > 0) {
                verbas['Pensão Alimentícia'] = { valor: -pensaoValor, formula: 'Valor da pensão a ser descontado' };
                descontos += pensaoValor;
            }

            const liquido = bruto - descontos;
            
            return {
                bruto,
                descontos,
                liquido,
                verbas,
                elegibilidade
            };
        }
        
        // Renderização da interface
        function renderResult(result) {
            valorBruto.textContent = formatCurrency(result.bruto);
            valorDescontos.textContent = formatCurrency(result.descontos);
            valorLiquido.textContent = formatCurrency(result.liquido);
            resultSection.style.display = 'block';

            if (result.liquido < 0) {
                valorLiquido.textContent += ' (Valor a Pagar)';
                valorLiquido.parentElement.classList.add('negative');
            } else {
                valorLiquido.parentElement.classList.remove('negative');
            }
            
            calculationTableBody.innerHTML = '';
            for (const [key, value] of Object.entries(result.verbas)) {
                if (value.valor === 0 && !key.toLowerCase().includes('desconto')) continue;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${key}</td>
                    <td><small>${value.formula}</small></td>
                    <td class="${value.valor >= 0 ? 'valor-devido' : 'valor-desconto'}">${formatCurrency(value.valor)}</td>
                `;
                calculationTableBody.appendChild(row);
            }

            legalNotesList.innerHTML = '';
            if (result.elegibilidade.fgtsSaque) {
                legalNotesList.innerHTML += `<li><strong>Saque FGTS:</strong> Você terá direito a sacar o saldo total depositado.</li>`;
            } else {
                legalNotesList.innerHTML += `<li><strong>Saque FGTS:</strong> Não há direito ao saque do saldo do FGTS nesta modalidade.</li>`;
            }
            if (result.elegibilidade.seguroDesemprego) {
                legalNotesList.innerHTML += `<li><strong>Seguro-Desemprego:</strong> Você poderá ter direito ao benefício, se preencher os demais requisitos legais (tempo de trabalho, etc.).</li>`;
            } else {
                legalNotesList.innerHTML += `<li><strong>Seguro-Desemprego:</strong> Não há direito ao seguro-desemprego nesta modalidade.</li>`;
            }
            
            reportDateSpan.textContent = formatDate(new Date());
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateUIforType(tipo) {
            const avisoSelect = $('#avisoModelo');
            const avisoContainer = avisoSelect.parentElement;

            if (tipo === 'pedido-demissao') {
                avisoContainer.style.display = 'block';
                avisoSelect.value = 'nao-cumprido';
            } else if (tipo === 'sem-justa-causa' || tipo === 'rescisao-indireta' || tipo === 'acordo') {
                avisoContainer.style.display = 'block';
                avisoSelect.value = 'indenizado';
            } else {
                 avisoContainer.style.display = 'none';
            }
        }
        
        function updateFGTSFields() {
            if (fgtsOptionSelect.value === 'informar') {
                fgtsInformadoGroup.style.display = 'flex';
                fgtsEstimarGroup.style.display = 'none';
                $('#fgtsSaldo').required = true;
                $('#fgtsMeses').required = false;
            } else {
                fgtsInformadoGroup.style.display = 'none';
                fgtsEstimarGroup.style.display = 'flex';
                $('#fgtsSaldo').required = false;
                $('#fgtsMeses').required = true;
            }
        }
        
        function updatePensãoFields() {
            pensaoGroup.style.display = pensaoAbreCheckbox.checked ? 'flex' : 'none';
        }

        function createTableEditor(tableData, editorId, tableRef) {
            const editor = $(`#${editorId}`);
            editor.innerHTML = '';
            tableData.forEach((row, index) => {
                const div = document.createElement('div');
                div.classList.add('form-grid');
                div.style.gridTemplateColumns = '1fr 1fr 1fr';
                div.style.gap = '10px';
                div.innerHTML = `
                    <div class="form-group">
                        <label>Limite Faixa ${index + 1}</label>
                        <input type="text" class="currency" value="${row.limite === Infinity ? 'Acima' : row.limite.toFixed(2).replace('.', ',')}" data-field="limite" data-index="${index}">
                    </div>
                    <div class="form-group">
                        <label>Alíquota (%)</label>
                        <input type="number" step="0.1" value="${(row.aliquota * 100).toFixed(1)}" data-field="aliquota" data-index="${index}">
                    </div>
                    <div class="form-group">
                        <label>Dedução</label>
                        <input type="text" class="currency" value="${row.deducao.toFixed(2).replace('.', ',')}" data-field="deducao" data-index="${index}">
                    </div>
                `;
                editor.appendChild(div);

                div.querySelectorAll('input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const field = e.target.dataset.field;
                        const idx = parseInt(e.target.dataset.index);
                        let value = e.target.value;

                        if (e.target.classList.contains('currency')) {
                            value = parseCurrency(value);
                        } else if (field === 'aliquota') {
                            value = parseFloat(value) / 100;
                        } else {
                            value = parseFloat(value);
                        }
                        
                        if(editorId.includes('inss')) {
                            inssTabela[idx][field] = value;
                        } else {
                            irrfTabela[idx][field] = value;
                        }
                    });
                });
            });
        }
        
        // Lógica de exportação
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const content = $('#result-section');
            const originalDisplay = content.style.display;
            content.style.display = 'block'; // Ensure it's visible for capture

            try {
                const canvas = await html2canvas(content, { scale: 2 });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = imgWidth / imgHeight;
                const newImgHeight = pdfWidth / ratio;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, newImgHeight);
                pdf.save('estimativa_rescisao.pdf');
            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                showMessage("Erro na Exportação", "Ocorreu um problema ao tentar gerar o PDF.");
            } finally {
                if ($('#valor-liquido').textContent === 'R$ 0,00') {
                    content.style.display = originalDisplay;
                }
            }
        }
        
        // Lógica de compartilhamento
        function getShareLink() {
            const fieldsToShare = ['tipoDesligamento', 'salarioBase', 'dataAdmissao', 'dataDesligamento', 'avisoModelo', 'faltasDescontos', 'feriasVencidas', 'fgtsOption', 'fgtsSaldo', 'fgtsMeses', 'mediaHorasExtras', 'mediaAdicionais', 'mediaComissoes', 'pensaoAbre', 'pensaoValor'];
            const params = new URLSearchParams();
            fieldsToShare.forEach(id => {
                const element = $(`#${id}`);
                if (element) {
                    const value = element.type === 'checkbox' ? element.checked : element.value;
                    if (value) {
                         params.set(id, value);
                    }
                }
            });
            return `${window.location.origin}${window.location.pathname}?${params.toString()}`;
        }

        // Eventos
        window.addEventListener('load', () => {
            createTableEditor(inssTabela, 'inss-table-editor');
            createTableEditor(irrfTabela, 'irrf-table-editor');
            
            const params = new URLSearchParams(window.location.search);
            if (params.size > 0) {
                params.forEach((value, key) => {
                    const input = $(`#${key}`);
                    if (input) {
                        if (input.type === 'checkbox') input.checked = (value === 'true');
                        else input.value = value;
                    }
                });
                updateUIforType(tipoDesligamentoSelect.value);
                updateFGTSFields();
                updatePensãoFields();
                form.dispatchEvent(new Event('submit'));
            }
        });

        $$('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                $$('.tab-button').forEach(btn => btn.classList.remove('active'));
                $$('.tab-content').forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                $(`#${button.dataset.tab}`).classList.add('active');
            });
        });

        tipoDesligamentoSelect.addEventListener('change', (e) => updateUIforType(e.target.value));
        fgtsOptionSelect.addEventListener('change', updateFGTSFields);
        pensaoAbreCheckbox.addEventListener('change', updatePensãoFields);

        // Mascaramento de inputs
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('currency')) {
                let value = e.target.value.replace(/\D/g, '');
                value = (value / 100).toFixed(2) + '';
                value = value.replace(".", ",");
                value = value.replace(/(\d)(?=(\d{3})+(?!\d)+(,))/g, "$1.");
                e.target.value = value;
            }
        });
        
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = {
                tipoDesligamento: tipoDesligamentoSelect.value,
                salarioBase: parseCurrency($('#salarioBase').value),
                dataAdmissao: $('#dataAdmissao').value,
                dataDesligamento: $('#dataDesligamento').value,
                avisoModelo: $('#avisoModelo').value,
                faltasDescontos: parseCurrency($('#faltasDescontos').value),
                feriasVencidas: $('#feriasVencidas').checked,
                fgtsOption: fgtsOptionSelect.value,
                fgtsSaldo: parseCurrency($('#fgtsSaldo').value),
                fgtsMeses: parseInt($('#fgtsMeses').value) || 0,
                mediaHorasExtras: parseCurrency($('#mediaHorasExtras').value),
                mediaAdicionais: parseCurrency($('#mediaAdicionais').value),
                mediaComissoes: parseCurrency($('#mediaComissoes').value),
                pensaoAbre: pensaoAbreCheckbox.checked,
                pensaoValor: parseCurrency($('#pensaoValor').value)
            };
            
            const resultado = calcRescisao(formData);
            renderResult(resultado);
            scenarioComparisonSection.style.display = 'none';
        });

        compareBtn.addEventListener('click', () => {
            const formData = {
                salarioBase: parseCurrency($('#salarioBase').value),
                dataAdmissao: $('#dataAdmissao').value,
                dataDesligamento: $('#dataDesligamento').value,
                fgtsOption: fgtsOptionSelect.value,
                fgtsSaldo: parseCurrency($('#fgtsSaldo').value),
                fgtsMeses: parseInt($('#fgtsMeses').value) || 0,
                mediaHorasExtras: parseCurrency($('#mediaHorasExtras').value),
                mediaAdicionais: parseCurrency($('#mediaAdicionais').value),
                mediaComissoes: parseCurrency($('#mediaComissoes').value),
                pensaoAbre: pensaoAbreCheckbox.checked,
                pensaoValor: parseCurrency($('#pensaoValor').value),
                faltasDescontos: parseCurrency($('#faltasDescontos').value),
                feriasVencidas: $('#feriasVencidas').checked
            };
            
            const scenarios = ['sem-justa-causa', 'pedido-demissao', 'justa-causa', 'acordo'];
            comparisonTableBody.innerHTML = '';
            
            const results = scenarios.map(tipo => {
                const scenarioData = { ...formData, tipoDesligamento: tipo, avisoModelo: 'indenizado' };
                if (tipo === 'pedido-demissao') scenarioData.avisoModelo = 'nao-cumprido';
                return calcRescisao(scenarioData);
            });

            const rowsData = [
                { label: 'Total Bruto', key: 'bruto' },
                { label: 'Total Descontos', key: 'descontos' },
                { label: '<strong>Líquido a Receber</strong>', key: 'liquido' }
            ];

            rowsData.forEach(rowData => {
                 const row = document.createElement('tr');
                 row.innerHTML = `<td>${rowData.label}</td>` + results.map(r => `<td>${rowData.key === 'liquido' ? '<strong>' : ''}${formatCurrency(r[rowData.key])}${rowData.key === 'liquido' ? '</strong>' : ''}</td>`).join('');
                 comparisonTableBody.appendChild(row);
            });

            scenarioComparisonSection.style.display = 'block';
            resultSection.style.display = 'none';
            scenarioComparisonSection.scrollIntoView({ behavior: 'smooth' });
        });
        
        limparBtn.addEventListener('click', () => {
            form.reset();
            
            // Restaurar valores padrão para inputs de currency
            $$('.currency').forEach(input => {
                if (input.id !== 'salarioBase' && input.id !== 'fgtsSaldo') {
                     input.value = '0,00';
                }
            });

            updateUIforType(tipoDesligamentoSelect.value);
            updateFGTSFields();
            updatePensãoFields();

            resultSection.style.display = 'none';
            scenarioComparisonSection.style.display = 'none';
        });

        printBtn.addEventListener('click', () => window.print());
        pdfBtn.addEventListener('click', exportToPDF);
        
        shareBtn.addEventListener('click', () => {
            const shareLink = getShareLink();
            navigator.clipboard.writeText(shareLink).then(() => {
                showMessage("Link Copiado!", "O link com os dados da sua simulação foi copiado. Você pode colá-lo em qualquer lugar para compartilhar.");
            }).catch(err => {
                console.error('Erro ao copiar link: ', err);
                showMessage("Erro", "Não foi possível copiar o link automaticamente. Por favor, copie o endereço da página.");
            });
        });

        whatsappBtn.addEventListener('click', () => {
            const text = `Olá, Dr. Marcílio. Fiz uma simulação na sua calculadora de rescisão. Gostaria de uma análise do meu caso.\n\nConfira os dados da minha simulação aqui: ${getShareLink()}`;
            const url = `https://api.whatsapp.com/send?phone=5538992317937&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        });

    </script>
</body>
</html>

